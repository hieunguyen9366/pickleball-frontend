<div class="auth-page">
  <div class="auth-container">
    <div class="auth-card-wrapper">
      <!-- Logo/Brand -->
      <div class="auth-header text-center mb-4">
        <a routerLink="/player/landing" class="auth-logo">
          <h2 class="mb-0">Pickleball Court</h2>
        </a>
        <p class="text-muted mt-2 mb-0">Đặt lại mật khẩu</p>
      </div>

      <!-- Reset Password Card -->
      <app-card [showHeader]="false" blockClass="auth-card">
        <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()" class="auth-form">
          <!-- Success Message -->
          <div class="alert alert-success" *ngIf="successMessage" role="alert">
            <i antIcon type="check-circle" theme="outline" class="me-2"></i>
            {{ successMessage }}
          </div>

          <!-- Error Message -->
          <div class="alert alert-danger" *ngIf="errorMessage" role="alert">
            <i antIcon type="close-circle" theme="fill" class="me-2"></i>
            {{ errorMessage }}
          </div>

          <!-- Token Error -->
          <div class="alert alert-danger" *ngIf="!token && !errorMessage" role="alert">
            <i antIcon type="close-circle" theme="fill" class="me-2"></i>
            Token không hợp lệ. Vui lòng kiểm tra lại link.
          </div>

          <!-- New Password Field -->
          <div class="form-group mb-3" *ngIf="token">
            <label class="form-label f-w-600" for="newPassword">
              Mật khẩu mới <span class="text-danger">*</span>
            </label>
            <div class="input-wrapper">
              <i antIcon type="lock" theme="outline" class="input-icon"></i>
              <input
                [type]="showPassword ? 'text' : 'password'"
                id="newPassword"
                formControlName="newPassword"
                class="form-control"
                [class.is-invalid]="resetPasswordForm.get('newPassword')?.invalid && resetPasswordForm.get('newPassword')?.touched"
                placeholder="Nhập mật khẩu mới (tối thiểu 6 ký tự)"
                autocomplete="new-password"
              />
              <button
                type="button"
                class="password-toggle"
                (click)="togglePasswordVisibility()"
                tabindex="-1">
                <i antIcon [type]="showPassword ? 'eye-invisible' : 'eye'" theme="outline"></i>
              </button>
            </div>
            <div class="invalid-feedback d-block" *ngIf="resetPasswordForm.get('newPassword')?.invalid && resetPasswordForm.get('newPassword')?.touched">
              <div *ngIf="resetPasswordForm.get('newPassword')?.errors?.['required']">Mật khẩu mới là bắt buộc</div>
              <div *ngIf="resetPasswordForm.get('newPassword')?.errors?.['minlength']">Mật khẩu phải có ít nhất 6 ký tự</div>
            </div>
          </div>

          <!-- Confirm Password Field -->
          <div class="form-group mb-4" *ngIf="token">
            <label class="form-label f-w-600" for="confirmPassword">
              Xác nhận mật khẩu mới <span class="text-danger">*</span>
            </label>
            <div class="input-wrapper">
              <i antIcon type="lock" theme="outline" class="input-icon"></i>
              <input
                [type]="showConfirmPassword ? 'text' : 'password'"
                id="confirmPassword"
                formControlName="confirmPassword"
                class="form-control"
                [class.is-invalid]="(resetPasswordForm.get('confirmPassword')?.invalid || resetPasswordForm.errors?.['passwordMismatch']) && resetPasswordForm.get('confirmPassword')?.touched"
                placeholder="Nhập lại mật khẩu mới"
                autocomplete="new-password"
              />
              <button
                type="button"
                class="password-toggle"
                (click)="toggleConfirmPasswordVisibility()"
                tabindex="-1">
                <i antIcon [type]="showConfirmPassword ? 'eye-invisible' : 'eye'" theme="outline"></i>
              </button>
            </div>
            <div class="invalid-feedback d-block" *ngIf="(resetPasswordForm.get('confirmPassword')?.invalid || resetPasswordForm.errors?.['passwordMismatch']) && resetPasswordForm.get('confirmPassword')?.touched">
              <div *ngIf="resetPasswordForm.get('confirmPassword')?.errors?.['required']">Xác nhận mật khẩu là bắt buộc</div>
              <div *ngIf="resetPasswordForm.errors?.['passwordMismatch'] && resetPasswordForm.get('confirmPassword')?.touched">
                Mật khẩu không khớp
              </div>
            </div>
          </div>

          <!-- Submit Button -->
          <div class="d-grid mb-4" *ngIf="token">
            <button
              type="submit"
              class="btn btn-primary btn-lg"
              [disabled]="resetPasswordForm.invalid || isLoading">
              <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status"></span>
              <i antIcon type="lock" theme="outline" class="me-2" *ngIf="!isLoading"></i>
              <span>{{ isLoading ? 'Đang xử lý...' : 'Đặt lại mật khẩu' }}</span>
            </button>
          </div>

          <!-- Login Link -->
          <div class="auth-footer text-center mt-4">
            <p class="text-muted mb-0">
              Nhớ mật khẩu?
              <a routerLink="/player/login" class="link-primary f-w-600">Đăng nhập ngay</a>
            </p>
          </div>
        </form>
      </app-card>
    </div>
  </div>
</div>

